<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Fitness index | WILD6900: Reproducible Science Project</title>
  <meta name="description" content="This is the bookdown file desrcibing the process I am taking in constructing my final project for WILD6900: Reproducible Science, a graduate course at Utah State University." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Fitness index | WILD6900: Reproducible Science Project" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the bookdown file desrcibing the process I am taking in constructing my final project for WILD6900: Reproducible Science, a graduate course at Utah State University." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Fitness index | WILD6900: Reproducible Science Project" />
  
  <meta name="twitter:description" content="This is the bookdown file desrcibing the process I am taking in constructing my final project for WILD6900: Reproducible Science, a graduate course at Utah State University." />
  

<meta name="author" content="Katy Gardner" />


<meta name="date" content="2021-04-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="survival.html"/>

<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WILD6900: Reproducible Science Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#project-goals"><i class="fa fa-check"></i><b>1.1</b> Project Goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#project-outline"><i class="fa fa-check"></i><b>1.2</b> Project Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="database.html"><a href="database.html"><i class="fa fa-check"></i><b>2</b> Building my SQLite database</a><ul>
<li class="chapter" data-level="2.1" data-path="database.html"><a href="database.html#usual-water-data"><i class="fa fa-check"></i><b>2.1</b> USUAL water data</a></li>
<li class="chapter" data-level="2.2" data-path="database.html"><a href="database.html#survival-data"><i class="fa fa-check"></i><b>2.2</b> Survival data</a></li>
<li class="chapter" data-level="2.3" data-path="database.html"><a href="database.html#weekly-water-measurements"><i class="fa fa-check"></i><b>2.3</b> Weekly water measurements</a></li>
<li class="chapter" data-level="2.4" data-path="database.html"><a href="database.html#head-widths"><i class="fa fa-check"></i><b>2.4</b> Head widths</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="survival.html"><a href="survival.html"><i class="fa fa-check"></i><b>3</b> Survival</a><ul>
<li class="chapter" data-level="3.1" data-path="survival.html"><a href="survival.html#load-in-data"><i class="fa fa-check"></i><b>3.1</b> Load in data</a></li>
<li class="chapter" data-level="3.2" data-path="survival.html"><a href="survival.html#plots"><i class="fa fa-check"></i><b>3.2</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fitness.html"><a href="fitness.html"><i class="fa fa-check"></i><b>4</b> Fitness index</a><ul>
<li class="chapter" data-level="4.1" data-path="fitness.html"><a href="fitness.html#generate-fitness-index"><i class="fa fa-check"></i><b>4.1</b> Generate fitness index</a></li>
<li class="chapter" data-level="4.2" data-path="fitness.html"><a href="fitness.html#data-visualization"><i class="fa fa-check"></i><b>4.2</b> Data visualization</a><ul>
<li class="chapter" data-level="4.2.1" data-path="fitness.html"><a href="fitness.html#d-surface-plot"><i class="fa fa-check"></i><b>4.2.1</b> 3D Surface plot</a></li>
<li class="chapter" data-level="4.2.2" data-path="fitness.html"><a href="fitness.html#grouped-bar-plots"><i class="fa fa-check"></i><b>4.2.2</b> Grouped bar plots</a></li>
<li class="chapter" data-level="4.2.3" data-path="fitness.html"><a href="fitness.html#fitness-index-averaged-bar-plots"><i class="fa fa-check"></i><b>4.2.3</b> Fitness index averaged bar plots</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WILD6900: Reproducible Science Project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fitness" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Fitness index</h1>
<p>We are ultimately interested in how overall organism fitness is impacted by sulfate levels. We can better visualize that through a fitness index that combines survival and growth measurements. The fitness index is calculated by multiplying percent survival by the average growth rate (G) for each treatment.</p>
<div id="generate-fitness-index" class="section level2">
<h2><span class="header-section-number">4.1</span> Generate fitness index</h2>
<p>To generate our fitness index, we first need to source the data we’re interested in from our database <code>ptery_sulf_db</code> (Chapter <a href="database.html#database">2</a>). We will be using data from the <code>head_width</code> and <code>survival</code> tables, but only grabbing data for bugs who survived until the end of the experiment (week 22). We will also be omitting the first week of measurement data in <code>head_width</code> due to issues with observer error.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># only select head width information of individuals that were alive on 2nd measurement day and last</span></a>
<a class="sourceLine" id="cb29-2" title="2">hw_survivors &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(ptery_sulf_db, <span class="st">&quot;SELECT *</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">                                            FROM (SELECT *          </span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">                                                  FROM head_width</span></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="st">                                                  WHERE bug_id IN(</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="st">                                                      SELECT bug_id</span></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="st">                                                      FROM head_width</span></a>
<a class="sourceLine" id="cb29-8" title="8"><span class="st">                                                      GROUP BY bug_id</span></a>
<a class="sourceLine" id="cb29-9" title="9"><span class="st">                                                      HAVING COUNT(DISTINCT meas_id) = 12))</span></a>
<a class="sourceLine" id="cb29-10" title="10"><span class="st">                                            WHERE (week = 2) OR (week = 22);&quot;</span>) </a>
<a class="sourceLine" id="cb29-11" title="11"><span class="co">#nested inquiry isolates individuals alive on all dates</span></a>
<a class="sourceLine" id="cb29-12" title="12"><span class="co">#WHERE statement selects only the data from last first and last measurement dates</span></a>
<a class="sourceLine" id="cb29-13" title="13"></a>
<a class="sourceLine" id="cb29-14" title="14"></a>
<a class="sourceLine" id="cb29-15" title="15">end_survival &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(ptery_sulf_db, <span class="st">&quot;SELECT *</span></a>
<a class="sourceLine" id="cb29-16" title="16"><span class="st">                                           FROM survival</span></a>
<a class="sourceLine" id="cb29-17" title="17"><span class="st">                                           WHERE date = &#39;2020-12-28&#39;;&quot;</span>)</a>
<a class="sourceLine" id="cb29-18" title="18"><span class="kw">sum</span>(end_survival<span class="op">$</span>survival)  </a></code></pre></div>
<pre><code>## [1] 240</code></pre>
<p>Output should read 240, which is the number of individuals alive in the last measurement date out of 360.</p>
<p>Next, we will calculate the growth rate for each individual using the specific growth rate (G) equation.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">hw_survivors &lt;-<span class="st"> </span>hw_survivors[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span><span class="op">:</span><span class="dv">7</span>)]</a>
<a class="sourceLine" id="cb31-2" title="2">hw_survivors &lt;-<span class="st"> </span><span class="kw">spread</span>(hw_survivors, week, head_width)</a>
<a class="sourceLine" id="cb31-3" title="3"></a>
<a class="sourceLine" id="cb31-4" title="4">hw_survivors &lt;-<span class="st"> </span>hw_survivors <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">init =</span> <span class="dv">3</span>, <span class="dt">final =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ln =</span> <span class="kw">log</span>(final<span class="op">/</span>init), <span class="dt">G =</span> (ln<span class="op">/</span><span class="dv">140</span>)<span class="op">*</span><span class="dv">100</span> ) <span class="co">#140 days between 08/10 and 12/28</span></a>
<a class="sourceLine" id="cb31-7" title="7"></a>
<a class="sourceLine" id="cb31-8" title="8"><span class="co">#average growth rate for each tank</span></a>
<a class="sourceLine" id="cb31-9" title="9">tank_fit &lt;-<span class="st"> </span><span class="kw">aggregate</span>(hw_survivors[,<span class="dv">6</span>], <span class="kw">list</span>(hw_survivors<span class="op">$</span>tank), mean)</a>
<a class="sourceLine" id="cb31-10" title="10">tank_fit &lt;-<span class="st"> </span>tank_fit <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-11" title="11"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">tank =</span> Group<span class="fl">.1</span>, <span class="dt">avg_G =</span> x)</a></code></pre></div>
<p>To calculate the fitness index, we want survival to be represented as the proportion of individuals alive out of 10.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="co">#change survival numbers to proportions</span></a>
<a class="sourceLine" id="cb32-2" title="2">end_survival &lt;-<span class="st"> </span>end_survival <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">surv_prop =</span> survival<span class="op">/</span><span class="dv">10</span>)</a></code></pre></div>
<p>Finally, we will use the specific growth rate (G) data and the survival data to create our fitness index for each tank.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co">#create fitness index </span></a>
<a class="sourceLine" id="cb33-2" title="2">tank_fit &lt;-<span class="st"> </span>tank_fit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">surv_prop =</span> end_survival<span class="op">$</span>surv_prop,</a>
<a class="sourceLine" id="cb33-4" title="4">         <span class="dt">fit_index =</span> (surv_prop<span class="op">*</span>avg_G),</a>
<a class="sourceLine" id="cb33-5" title="5">         <span class="dt">temp =</span> end_survival<span class="op">$</span>set_temp,</a>
<a class="sourceLine" id="cb33-6" title="6">         <span class="dt">trtment =</span> end_survival<span class="op">$</span>sulfate_trtment)</a>
<a class="sourceLine" id="cb33-7" title="7"><span class="co">###NOTE: first, third, fourth line of mutate code only worked well bc tanks were in order in both df&#39;s</span></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="co">###would need to recode to include some &quot;by group&quot; argument to get to work otherwise</span></a></code></pre></div>
</div>
<div id="data-visualization" class="section level2">
<h2><span class="header-section-number">4.2</span> Data visualization</h2>
<div id="d-surface-plot" class="section level3">
<h3><span class="header-section-number">4.2.1</span> 3D Surface plot</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">prep &lt;-<span class="st"> </span>tank_fit[<span class="kw">order</span>(tank_fit<span class="op">$</span>trtment),] <span class="co">#reordering survival.wide by sulfate level</span></a>
<a class="sourceLine" id="cb34-2" title="2">prep1 &lt;-<span class="st"> </span>prep[<span class="kw">order</span>(prep<span class="op">$</span>temp),] <span class="co">#now reordering by temperature</span></a>
<a class="sourceLine" id="cb34-3" title="3"></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="co">#you want the reordering steps so that you can predictably label the z matrix w/ temp and sulfate </span></a>
<a class="sourceLine" id="cb34-5" title="5"><span class="co">#column/row names. the original survival.wide had treatments in no particular order</span></a>
<a class="sourceLine" id="cb34-6" title="6">temp &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">12</span>, <span class="dv">22</span>, <span class="dv">2</span>) <span class="co">#setting up matrix colnames</span></a>
<a class="sourceLine" id="cb34-7" title="7">sulf &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">200</span>) <span class="co">#rownames</span></a>
<a class="sourceLine" id="cb34-8" title="8"></a>
<a class="sourceLine" id="cb34-9" title="9">z &lt;-<span class="st"> </span><span class="kw">matrix</span>(prep1<span class="op">$</span>fit_index, <span class="dv">6</span>, <span class="dv">6</span>) <span class="co">#reformatting 36 survival data points into matrix, by treatment</span></a>
<a class="sourceLine" id="cb34-10" title="10"></a>
<a class="sourceLine" id="cb34-11" title="11"><span class="kw">rownames</span>(z) &lt;-<span class="st"> </span>sulf</a>
<a class="sourceLine" id="cb34-12" title="12"><span class="kw">colnames</span>(z) &lt;-<span class="st"> </span>temp</a>
<a class="sourceLine" id="cb34-13" title="13"></a>
<a class="sourceLine" id="cb34-14" title="14">surf_fit &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(<span class="dt">type =</span> <span class="st">&quot;surface&quot;</span>, <span class="dt">z=</span>z, <span class="dt">x=</span>temp, <span class="dt">y=</span>sulf)</a>
<a class="sourceLine" id="cb34-15" title="15">surf_fit &lt;-<span class="st"> </span>surf_fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layout</span>(<span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&#39;Temperature&#39;</span>),</a>
<a class="sourceLine" id="cb34-16" title="16">                                             <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&#39;Sulfate mg/L&#39;</span>),</a>
<a class="sourceLine" id="cb34-17" title="17">                                             <span class="dt">zaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&#39;Fitness Index&#39;</span>)))</a>
<a class="sourceLine" id="cb34-18" title="18"></a>
<a class="sourceLine" id="cb34-19" title="19">surf_fit</a></code></pre></div>
<div id="htmlwidget-3110a3dd64e27a9abbde" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3110a3dd64e27a9abbde">{"x":{"visdat":{"2820621f1246":["function () ","plotlyVisDat"]},"cur_data":"2820621f1246","attrs":{"2820621f1246":{"z":[[0.140685143412217,0.143220950434744,0.176697243439627,0.109929108894883,0.118895798454461,0.108444125629431],[0.081867758815438,0.21668532245432,0.161802198716668,0.177295994291742,0.122468594904893,0.100359487782655],[0.114387836057187,0.191557804736859,0.206256853936537,0.186164270764454,0.0730318247364414,0.0923689928860526],[0.121601175372995,0.103830797166539,0.109931478140631,0.125601968954413,0.0879222850884593,0.085094968421349],[0.0537208318218097,0.0224041113467887,0.141439890436286,0.107377682625295,0.0139102911994651,0.113852619572023],[0.0890226758206065,0.0226753021989608,0.244732063437085,0.188301331869503,0.0731876349440555,0.194455762352886]],"x":[12,14,16,18,20,22],"y":[0,200,400,600,800,1000],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Temperature"},"yaxis":{"title":"Sulfate mg/L"},"zaxis":{"title":"Fitness Index"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[[0.140685143412217,0.143220950434744,0.176697243439627,0.109929108894883,0.118895798454461,0.108444125629431],[0.081867758815438,0.21668532245432,0.161802198716668,0.177295994291742,0.122468594904893,0.100359487782655],[0.114387836057187,0.191557804736859,0.206256853936537,0.186164270764454,0.0730318247364414,0.0923689928860526],[0.121601175372995,0.103830797166539,0.109931478140631,0.125601968954413,0.0879222850884593,0.085094968421349],[0.0537208318218097,0.0224041113467887,0.141439890436286,0.107377682625295,0.0139102911994651,0.113852619572023],[0.0890226758206065,0.0226753021989608,0.244732063437085,0.188301331869503,0.0731876349440555,0.194455762352886]],"x":[12,14,16,18,20,22],"y":[0,200,400,600,800,1000],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Not seeing a clear trend from the 3D surface plot, whether it be to temperature, sulfate, or an interaction of the two.
(hint: it moves! drag it around to view from different angles)</p>
</div>
<div id="grouped-bar-plots" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Grouped bar plots</h3>
<p>Let’s visualize the data by one treatment at a time (temperature first, then sulfate).
The method we will use here still shows individual tanks and what their treatment level was of the other treatment, but we group bars by the primary treatment we are visualizing.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">tank_fit<span class="op">$</span>temp &lt;-<span class="st"> </span><span class="kw">as.factor</span>(tank_fit<span class="op">$</span>temp)</a>
<a class="sourceLine" id="cb35-2" title="2">tank_fit<span class="op">$</span>trtment &lt;-<span class="st"> </span><span class="kw">as.factor</span>(tank_fit<span class="op">$</span>trtment)</a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="co">#grouped by temp</span></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="kw">ggplot</span>(tank_fit, <span class="kw">aes</span>(<span class="dt">fill=</span>trtment, <span class="dt">y=</span>fit_index, <span class="dt">x=</span>temp)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb35-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Temperature (°C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Fitness Index&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Sulfate (mg/L)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-9" title="9"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="project_bookdown_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co">#grouped by sulfate treatment</span></a>
<a class="sourceLine" id="cb36-2" title="2"><span class="kw">ggplot</span>(tank_fit, <span class="kw">aes</span>(<span class="dt">fill=</span>temp, <span class="dt">y=</span>fit_index, <span class="dt">x=</span>trtment)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb36-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb36-4" title="4"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb36-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sulfate (mg/L)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Fitness Index&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Temperature (°C)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="project_bookdown_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<p>Hmm… again, no clear patterns. Perhaps this is because grouped bar plots like this are a bit messy. Let’s average fitness index values across single treatments to simplify the plots.</p>
</div>
<div id="fitness-index-averaged-bar-plots" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Fitness index averaged bar plots</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co">#fitness index averaged by temp</span></a>
<a class="sourceLine" id="cb37-2" title="2">avg &lt;-<span class="st"> </span>tank_fit <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(temp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fit_index =</span> <span class="kw">mean</span>(fit_index))</a>
<a class="sourceLine" id="cb37-5" title="5"></a>
<a class="sourceLine" id="cb37-6" title="6"><span class="kw">ggplot</span>(tank_fit, <span class="kw">aes</span>(<span class="dt">x=</span>temp, <span class="dt">y=</span>fit_index, <span class="dt">color =</span> temp, <span class="dt">fill =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-8" title="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data=</span>avg, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-9" title="9"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> tank), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">segment.color =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-10" title="10"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-12" title="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Temperature (°C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Fitness Index&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-13" title="13"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-14" title="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="project_bookdown_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co">#fitness index averaged by sulfate treatment</span></a>
<a class="sourceLine" id="cb38-2" title="2">avg &lt;-<span class="st"> </span>tank_fit <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(trtment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fit_index =</span> <span class="kw">mean</span>(fit_index))</a>
<a class="sourceLine" id="cb38-5" title="5"></a>
<a class="sourceLine" id="cb38-6" title="6"><span class="kw">ggplot</span>(tank_fit, <span class="kw">aes</span>(<span class="dt">x=</span>trtment, <span class="dt">y=</span>fit_index, <span class="dt">color =</span> trtment, <span class="dt">fill =</span> trtment)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb38-8" title="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data=</span>avg, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-9" title="9"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> tank), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">segment.color =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-10" title="10"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb38-11" title="11"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb38-12" title="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sulfate (mg/L)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Fitness Index&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-13" title="13"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb38-14" title="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="project_bookdown_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
<p>In the plots, the points represent individual tanks, while the bars represent the average fitness index of those tanks.</p>
<p>There is <em>almost</em> a unimodal patterned response to temperature, but fitness is a bit higher in the highest temp. This is surprising, because other research from my lab has shown <em>Pteronarcys californica</em> has an optimal temperature of about 14-16, and really marginal to no survival at high temperatures like 22C. No clear trends in response to sulfate levels.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="survival.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["project_bookdown.pdf", "project_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
